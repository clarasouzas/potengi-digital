{% extends "dashboard/base_dashboard.html" %}
{% load django_tables2 %}
{% load static %}

{% block titulo %}Mensagens Respondidas{% endblock %}

{% block conteudo %}

<h2 class="title-dashboard mb-4 d-flex align-items-center justify-content-between">
    <span><i class="bi bi-envelope-open me-2"></i> Mensagens Respondidas</span>

    <a href="#nova-msg" class="btn-table w-200">
        <i class="bi bi-plus-circle" style="fontsize: 16px;"></i>
    </a>
</h2>

{% if table.page.object_list %}
<div class="table-container">
    {% render_table table %}
</div>

<!-- ===== MODAL DETALHES ===== -->
{% for row in table.page.object_list %}
{% with msg=row.record %}
<div id="mensagem-{{ msg.id }}" class="modal-vaga">

    <div class="modal-content-vaga">

        <a href="#" class="modal-close"><i class="bi bi-x-lg"></i></a>

        <h3 class="fw-bold mb-3">
            <i class="bi bi-chat-text me-2"></i>
            Detalhes da Mensagem
        </h3>

        <p><strong>Sua mensagem:</strong></p>
        <p>{{ msg.mensagem }}</p>

        <hr>

        <p><strong>Resposta recebida:</strong></p>
        <p>{{ msg.resposta }}</p>

        <p class="text-muted mt-3">
            Enviada em {{ msg.data_envio|date:"d/m/Y H:i" }}
        </p>

        <div class="d-flex justify-content-end mt-4">
            <a href="#" class="btn-table"
               style="background: var(--gray-300); color: var(--gray-800);">
                Fechar
            </a>
        </div>

    </div>
</div>
{% endwith %}
{% endfor %}

{% else %}
<div class="empty-state-wrapper d-flex align-items-center justify-content-center gap-4 py-5">

    <img src="{% static 'assets/img/empty.svg' %}" class="empty-img" style="width:420px">

    <div class="empty-state-text" style="max-width:380px;">
        <h5 class="fw-bold mb-2">Nenhuma resposta recebida</h5>
        <p class="text-muted">
            Assim que a coordenação responder alguma mensagem sua,
            ela aparecerá aqui.
        </p>
    </div>

</div>
{% endif %}

<!-- ===== MODAL NOVA MENSAGEM ===== -->
<div id="nova-msg" class="modal-vaga">

    <div class="modal-content-vaga">

        <!-- Fechar -->
        <a href="#" class="modal-close">
            <i class="bi bi-x-lg"></i>
        </a>

        <h3 class="fw-bold mb-3">
            <i class="bi bi-envelope-plus me-2"></i>
            Enviar Nova Mensagem
        </h3>

        <form method="post" action="{% url 'dashboard:enviar_mensagem' %}">
            {% csrf_token %}

            <!-- NOME -->
            <div class="mb-3">
                <label class="form-label fw-semibold">
                    Nome
                </label>
                <input type="text" name="nome" value="{{ request.user.nome }}"
                       class="form-control" required>
            </div>

            <!-- EMAIL -->
            <div class="mb-3">
                <label class="form-label fw-semibold">
                    E-mail
                </label>
                <input type="email" name="email" value="{{ request.user.email }}"
                       class="form-control" required>
            </div>

            <!-- MENSAGEM -->
            <div class="mb-3">
                <label class="form-label fw-semibold">
                    Mensagem
                </label>
                <textarea name="mensagem" rows="5" class="form-control" required></textarea>
            </div>

            <div class="d-flex gap-3 mt-4">

                <button class="btn-save">
                    <i class="bi bi-send-check me-1"></i> Enviar
                </button>

                <a href="#" class="btn-table"
                   style="background: var(--gray-300); color: var(--gray-800); box-shadow:none;">
                    Cancelar
                </a>

            </div>

        </form>

    </div>

</div>

{% endblock %}
