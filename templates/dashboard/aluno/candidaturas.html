{% extends "dashboard/base_dashboard.html" %}
{% load static %}

{% block titulo %}Minhas Candidaturas{% endblock %}

{% block conteudo %}

<h2 class="title-dashboard mb-4">
    <i class="bi-file-earmark-check me-2"></i>Minhas Candidaturas
</h2>

{% if candidaturas %}

<div class="row g-3">

    {% for c in candidaturas %}
    <div class="col-12 col-md-6 col-lg-4">

        <div class="card-list">

            <div class="card-title">{{ c.vaga.titulo }}</div>

            <div class="card-meta">
                <i class="bi bi-building me-1"></i>
                {{ c.vaga.empresa.nome }}
            </div>

            <div class="card-meta">
                <i class="bi bi-calendar2-week me-1"></i>
                {{ c.data_candidatura|date:"d/m/Y" }}
            </div>

            <div class="mt-2">
                {% if c.status == "pendente" %}
                    <span class="badge pend"><i class="bi bi-hourglass-split me-1"></i>Pendente</span>
                {% elif c.status == "em_analise" %}
                    <span class="badge anls"><i class="bi bi-search me-1"></i>Em análise</span>
                {% elif c.status == "aprovado" %}
                    <span class="badge aprov"><i class="bi bi-check2-circle me-1"></i>Aprovado</span>
                {% elif c.status == "recusado" %}
                    <span class="badge recs"><i class="bi bi-x-circle me-1"></i>Recusado</span>
                {% endif %}
            </div>

            <div class="card-actions">

                <!-- AGORA ABRE O MODAL COM :target -->
                <a href="#modal-{{ c.id }}" class="btn-outline-action">
                    <i class="bi bi-eye"></i> Ver Vaga
                </a>

                <a href="{% url 'dashboard:cancelar_candidatura' c.id %}"
                   class="btn-outline-action">
                    <i class="bi bi-trash"></i> Cancelar
                </a>

            </div>
        </div>
    </div>


    <!-- ======================================================
         MODAL DETALHES DA VAGA — MESMAS CLASSES DA SUA PÁGINA
    ====================================================== -->
    <div id="modal-{{ c.id }}" class="modal-vaga">

        <div class="modal-content-vaga">

            <!-- fechar modal -->
            <a href="#" class="modal-close"><i class="bi bi-x-lg"></i></a>

            <h3 class="title-section fw-bold">{{ c.vaga.titulo }}</h3>

            <div class="modal-badges">
                <span class="tag-chip"><i class="bi bi-buildings"></i> {{ c.vaga.empresa.nome|upper }}</span>
                <span class="tag-chip"><i class="bi bi-geo-alt"></i> {{ c.vaga.cidade }}/RN</span>
                <span class="tag-chip"><i class="bi bi-briefcase"></i> {{ c.vaga.get_tipo_display }}</span>

                {% if c.vaga.remuneracao %}
                <span class="tag-chip"><i class="bi bi-cash"></i> R$ {{ c.vaga.remuneracao }}</span>
                {% endif %}
            </div>

            <hr>

            <h5 class="title-section">Descrição</h5>
            <p>{{ c.vaga.descricao|default:"Sem descrição informada." }}</p>

            <h5 class="title-section">Requisitos</h5>
            <p>{{ c.vaga.requisitos|default:"Nenhum requisito informado." }}</p>

            {% if c.vaga.data_publicacao %}
            <span class="modal-date-chip">
                Publicada em {{ c.vaga.data_publicacao|date:"d/m/Y" }}
            </span>
            {% endif %}

        </div>
    </div>

    {% endfor %}
</div>
{% else %}

<div class="empty-state-wrapper py-5"
     style="
        display:flex;
        align-items:center;
        justify-content:center;
        gap:32px;
        text-align:left;
     ">

    <!-- IMAGEM GRANDE -->
    <img src="{% static 'assets/img/empty.svg' %}"
         alt="Nenhuma candidatura recebida"
         class="empty-img"
         style="width: 340px; height:auto; flex-shrink:0;">

    <!-- TEXTO -->
    <div class="empty-state-text">
        <h5 class="fw-bold mb-2">Você ainda não cadastrou nenhuma vaga</h5>

        <p class="text-muted m-0" style="max-width:480px;">
            Adicione sua primeira vaga para começar a receber candidaturas dos alunos.
        </p>
    </div>

</div>
{% endif %}


{% endblock %}
