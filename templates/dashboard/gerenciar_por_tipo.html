{% extends "dashboard/base_dashboard.html" %}
{% load django_tables2 %}
{% load static %}

{% block titulo %}
Gerenciar {{ tipo|title }}
{% endblock %}

{% block conteudo %}

<h2 class="title-dashboard mb-4">
    {% if tipo == "aluno" %}
        <i class="bi bi-people-fill me-2"></i>
        Gerenciar Alunos
    {% else %}
        <i class="bi bi-building me-2"></i>
        Gerenciar Empresas
    {% endif %}
</h2>

<!-- ========================
     FILTROS DE STATUS
========================= -->
<div class="mb-4 d-flex gap-2">
    <a href="?status=pendente" class="btn-table">Pendentes</a>
    <a href="?status=aprovado" class="btn-table">Aprovados</a>
    <a href="?status=reprovado" class="btn-table">Reprovados</a>
    <a href="." class="btn-table" style="background: var(--gray-200); color: var(--gray-800);">Limpar</a>
</div>

{% if table.page.object_list %}
<div class="table-container">
    {% render_table table %}
</div>

<!-- ========================
     MODAIS PARA CADA LINHA
========================= -->
{% for row in table.page.object_list %}
{% with user=row.record %}

<!-- MODAL APROVAR -->
<div id="modal-aprovar-{{ user.id }}" class="modal-vaga">

    <div class="modal-content-vaga">

        <a href="#" class="modal-close">
            <i class="bi bi-x-lg"></i>
        </a>

        
        <h3 class="fw-bold mb-3" style="color: var(--accent-blue);">
            <i class="bi bi-check-circle me-2"></i>
            Aprovar {{ tipo|title }}
        </h3>

        <p class="text-muted">
            Tem certeza que deseja aprovar
            <strong>{{ user.nome|default:user.email }}</strong>?
        </p>

        <div class="d-flex gap-3 mt-4">

            <a href="{% url 'dashboard:usuario_mudar_status' %}?acao=aprovar&usuario_id={{ user.id }}"
               class="btn-table flex-grow-1 text-center">
                Aprovar
            </a>

            <a href="#" class="btn-table flex-grow-1 text-center"
               style="background: var(--gray-300); color: var(--gray-800); box-shadow:none;">
                Cancelar
            </a>

        </div>
    </div>
</div>


<!-- MODAL REPROVAR -->
<div id="modal-reprovar-{{ user.id }}" class="modal-vaga">

    <div class="modal-content-vaga">

        <a href="#" class="modal-close">
            <i class="bi bi-x-lg"></i>
        </a>

        <h3 class="fw-bold mb-3" style="color: var(--accent-red);">
            <i class="bi bi-x-octagon me-2"></i>
            Reprovar {{ tipo|title }}
        </h3>

        <p class="text-muted">
            Tem certeza que deseja reprovar
            <strong>{{ user.nome|default:user.email }}</strong>?
        </p>

        <div class="d-flex gap-3 mt-4">

            <a href="{% url 'dashboard:usuario_mudar_status' %}?acao=reprovar&usuario_id={{ user.id }}"
               class="btn-delete btn-table flex-grow-1 text-center">
                Reprovar
            </a>

            <a href="#" class="btn-table flex-grow-1 text-center"
               style="background: var(--gray-300); color: var(--gray-800); box-shadow:none;">
                Cancelar
            </a>

        </div>
    </div>
</div>

{% endwith %}
{% endfor %}
{% for row in table.page.object_list %}
{% with user=row.record %}

<div id="excluir-{{ user.id }}" class="modal-vaga">

    <div class="modal-content-vaga">

        <a href="#" class="modal-close">
            <i class="bi bi-x-lg"></i>
        </a>

        <h3 class="fw-bold mb-3" style="color: var(--accent-red);">
            <i class="bi bi-trash me-2"></i>
            Excluir {{ tipo|title }}
        </h3>

        <p class="text-muted">
            Tem certeza que deseja excluir
            <strong>{{ user.nome|default:user.email }}</strong>?
            <br>
            <span style="color: var(--accent-red); font-size: 14px;">
                Esta ação não pode ser desfeita.
            </span>
        </p>

        <div class="d-flex gap-3 mt-4">

            <a href="{% url 'dashboard:usuario_excluir' user.id %}"
               class="btn-delete btn-table flex-grow-1 text-center">
                Excluir
            </a>

            <a href="#"
               class="btn-table flex-grow-1 text-center"
               style="background: var(--gray-300); color: var(--gray-800); box-shadow:none;">
                Cancelar
            </a>

        </div>
    </div>
</div>

{% endwith %}
{% endfor %}

{% else %}

<!-- ========================
     EMPTY STATE
========================= -->
<div class="empty-state-wrapper d-flex align-items-center justify-content-center gap-4 py-5">

    <img src="{% static 'assets/img/empty.svg' %}"
         class="empty-img"
         style="width: 420px; max-width: 100%;">

    <div class="empty-state-text" style="max-width: 380px;">
        <h5 class="fw-bold mb-2">Nenhum {{ tipo }} encontrado</h5>
        <p class="text-muted m-0">
            Assim que novos usuários forem cadastrados, aparecerão aqui.
        </p>
    </div>

</div>

{% endif %}

{% endblock %}
