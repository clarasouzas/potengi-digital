{% extends "dashboard/base_dashboard.html" %}
{% load django_tables2 %}
{% load static %}

{% block titulo %}Mensagens Recebidas{% endblock %}

{% block conteudo %}

<h2 class="title-dashboard mb-4">
    <i class="bi bi-envelope-paper me-2"></i>
    Mensagens Recebidas
</h2>

{% if table.page.object_list %}
<div class="table-container">
    {% render_table table %}
</div>


{% for row in table.page.object_list %}
{% with msg=row.record %}
<div id="mensagem-{{ msg.id }}" class="modal-vaga">

    <div class="modal-content-vaga">

        <a href="#" class="modal-close">
            <i class="bi bi-x-lg"></i>
        </a>

        <h3 class="fw-bold mb-3">
            <i class="bi bi-envelope-open me-2"></i>
            Detalhes da Mensagem
        </h3>

        <p><strong>Nome:</strong> {{ msg.nome }}</p>
        <p><strong>E-mail:</strong> {{ msg.email }}</p>
        <p><strong>Data:</strong> {{ msg.data_envio|date:"d/m/Y H:i" }}</p>

        <hr>

        <p class="mt-3">{{ msg.mensagem }}</p>

        <div class="d-flex gap-3 mt-4">

            {% if not msg.respondido %}
                <a href="#responder-{{ msg.id }}" class="btn-table">
                    Responder
                </a>
            {% endif %}

            <a href="#" class="btn-table"
               style="background: var(--gray-300); color: var(--gray-800); box-shadow:none;">
                Fechar
            </a>

        </div>

    </div>

</div>
{% endwith %}
{% endfor %}

{% for row in table.page.object_list %}
{% with msg=row.record %}
<div id="responder-{{ msg.id }}" class="modal-vaga">

    <div class="modal-content-vaga">

        <a href="#" class="modal-close">
            <i class="bi bi-x-lg"></i>
        </a>

        <h3 class="fw-bold mb-3">
            <i class="bi bi-reply-fill me-2"></i>
            Responder Mensagem
        </h3>

        <p><strong>Para:</strong> {{ msg.nome }} ({{ msg.email }})</p>

        <form method="post" action="{% url 'dashboard:responder_mensagem' msg.id %}">
            {% csrf_token %}

            <div class="mb-3">
                <label class="form-label">Sua resposta</label>
                <textarea name="resposta" class="form-control" rows="6" required></textarea>
            </div>

            <div class="d-flex gap-3 mt-4">
                <button class="btn-save">
                    <i class="bi bi-send-check me-1"></i> Enviar
                </button>

                <a href="#" class="btn-table"
                   style="background: var(--gray-300); color: var(--gray-800); box-shadow:none;">
                    Cancelar
                </a>
            </div>

        </form>

    </div>

</div>
{% endwith %}
{% endfor %}

{% else %}
<div class="empty-state-wrapper d-flex align-items-center justify-content-center gap-4 py-5">

    <img src="{% static 'assets/img/empty.svg' %}"
         class="empty-img"
         style="width: 420px; max-width: 100%;">

    <div class="empty-state-text" style="max-width: 380px;">
        <h5 class="fw-bold mb-2">Nenhuma mensagem recebida</h5>
        <p class="text-muted m-0">
            Assim que visitantes enviarem mensagens pelo formulário público,
            elas aparecerão aqui.
        </p>
    </div>

</div>

{% endif %}

{% endblock %}
